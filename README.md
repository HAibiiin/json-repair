# json-repair : A library for fixing JSON anomalies generated by LLMs.

[![Release](https://img.shields.io/github/release/HAibiiin/json-repair.svg?sort=semver)](https://github.com/HAibiiin/json-repair/releases/latest)
[![Maven Central](https://img.shields.io/maven-central/v/io.github.haibiiin/json-repair.svg)](https://search.maven.org/artifact/io.github.haibiiin/json-repair)
[![Apache 2.0 license](https://img.shields.io/badge/license-Apache%202.0-blue)](./LICENSE)
[![CN doc](https://img.shields.io/badge/文档-中文版-blue.svg)](https://github.com/HAibiiin/json-repair/blob/main/README-ZH.md)

![Logo](https://haibiiin.github.io/resources/json-repair-logo.png)

## What is json-repair?

**json-repair** is a Java library that provides repair for abnormal JSON generated by LLM (Large Language Model) at the application layer. Based on **json-repair**, the repair of abnormal JSON can be achieved simply, efficiently and accurately.

## Getting started

To get started with json-repair, first add it as a dependency in your Java project. If you're using Maven, that looks like this:

```xml
<dependency>
    <groupId>io.github.haibiiin</groupId>
    <artifactId>json-repair</artifactId>
    <version>0.2.1</version>
</dependency>
```
If you're using Gradle, that looks like this:

```
implementation 'io.github.haibiiin:json-repair:0.2.1'
```
Next, You can instantiate a `JSONRepair` object  then call `handle()` function to repair JSON string like so.

```java
JSONRepair repair = new JSONRepair();
String correctJSON = repair.handle(mistakeJSON);
```

## Feature

You can learn about all the JSON exceptions that the current version 0.2.1 of **json-repair** supports for repair by checking the [test case dataset](https://github.com/HAibiiin/json-repair/blob/main/src/test/resources/case/simple.xml) or [test report](https://haibiiin.github.io/json-repair/reports/testcase/).

The functions based on the current version 0.2.1 are as follows:

* Implement the basic repair function for JSON strings:
  * Adding the missing right parenthesis;
  * Adding the missing right square bracket;
  * Cleaning up the redundant commas when the value is in the form of an array;
  * Filling in the missing values with "null"；
  * Patch the missing left parentheses; 
  * Patch the missing outermost parentheses; 
  * Patch the lack of quotation marks for strings in individual scenarios;
  * Provide the number of custom patching attempts.

## Benchmark

You can conduct performance tests in more scenarios by running [BenchmarkTests](https://github.com/HAibiiin/json-repair/blob/main/src/test/java/io/github/haibiiin/json/repair/BenchmarkTests.java).

The benchmark based on the current version 0.2.1 as follows:

```
--AverageTime --NANOSECONDS --Warmup-5-1-SECONDS
Benchmark                                                          (anomalyJSON)    Mode     Cnt          Score         Error   Units
BenchmarkTests.testSimpleRepairStrategy                      {"f":"v", "f2":"v2"    avgt       5       9962.472 ±    4620.794   ns/op
BenchmarkTests.testSimpleRepairStrategy                         {"f":"v", "a":[1    avgt       5      46009.866 ±   69311.421   ns/op
BenchmarkTests.testSimpleRepairStrategy  {"f":"v", "a":[1,2], "o1":{"f1":"v1"},     avgt       5      17829.076 ±    7639.310   ns/op
BenchmarkTests.testSimpleRepairStrategy     "f":"v", "a":[1,2], "o1":{"f1":"v1"}    avgt       5      21846.849 ±    3140.165   ns/op
BenchmarkTests.testSimpleRepairStrategy                                      f:v    avgt       5      67068.748 ±   71123.925   ns/op

--AverageTime --MILLISECONDS --Warmup-5-1-SECONDS
Benchmark                                                          (anomalyJSON)    Mode     Cnt          Score         Error   Units
BenchmarkTests.testSimpleRepairStrategy                      {"f":"v", "f2":"v2"    avgt       5          0.012 ±       0.012   ms/op
BenchmarkTests.testSimpleRepairStrategy                         {"f":"v", "a":[1    avgt       5          0.099 ±       0.172   ms/op
BenchmarkTests.testSimpleRepairStrategy  {"f":"v", "a":[1,2], "o1":{"f1":"v1"},     avgt       5          0.066 ±       0.259   ms/op
BenchmarkTests.testSimpleRepairStrategy     "f":"v", "a":[1,2], "o1":{"f1":"v1"}    avgt       5          0.034 ±       0.034   ms/op
BenchmarkTests.testSimpleRepairStrategy                                      f:v    avgt       5          0.053 ±       0.021   ms/op
```

## Coverage

You can check out [report](https://haibiiin.github.io/json-repair/reports/coverage/) to learn about the details of the project's test coverage.

## Roadmap

 - [ ] Make more accurate corrections to abnormal JSON by providing reference JSON styles.

## License

json-repair is licensed under the [Apache-2.0 license](https://github.com/HAibiiin/json-repair/blob/master/LICENSE).
